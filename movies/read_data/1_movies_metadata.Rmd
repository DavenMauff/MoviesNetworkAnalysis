---
title: "R Notebook"
output: html_notebook
---

```{r}
pacman::p_load(rjson, jsonlite, DT,  RJSONIO, data.table, dplyr, compareDF)
```

```{r}
metadata = read.csv("../../data-raw/movies_metadata.csv")
```

```{r}
head(metadata$belongs_to_collection)
```

```{r}
metadata$belongs_to_collection <- gsub("'", '"', metadata$belongs_to_collection)
metadata$belongs_to_collection <- gsub('^$', '{}', metadata$belongs_to_collection)
metadata$genres <- gsub("'", '"', metadata$genres)
metadata$genres <- gsub('^$', '{}', metadata$genres)
metadata$production_companies <- gsub("'", '"', metadata$production_companies)
metadata$production_companies <- gsub('^$', '{}', metadata$production_companies)
metadata$production_countries <- gsub("'", '"', metadata$production_countries)
metadata$production_countries <- gsub('^$', '{}', metadata$production_countries)
metadata$spoken_languages <- gsub("'", '"', metadata$spoken_languages)
metadata$spoken_languages <- gsub('^$', '{}', metadata$spoken_languages)
```

```{r}
metadata_filtered <- metadata %>% 
  filter(genres != '[]')
metadata_filtered <- metadata_filtered %>% 
  filter(production_companies != '[]')
metadata_filtered <- metadata_filtered %>% 
  filter(production_countries != '[]')
metadata_filtered <- metadata_filtered %>% 
  filter(spoken_languages != '[]')
```

```{r}
#Validate the json and store the boolean result in a new column
metadata_filtered$genre_val <- lapply(metadata_filtered$genres, validate)
metadata_filtered$pro_com_val <- lapply(metadata_filtered$production_companies, validate)
metadata_filtered$pro_coun_val <- lapply(metadata_filtered$production_countries, validate)
metadata_filtered$spoken_val <- lapply(metadata_filtered$spoken_languages, validate)
```

```{r}
metadata_filtered <- metadata_filtered %>% 
  filter(genre_val==T)
metadata_filtered <- metadata_filtered %>% 
  filter(pro_com_val==T)
metadata_filtered <- metadata_filtered %>% 
  filter(pro_coun_val==T)
metadata_filtered <- metadata_filtered %>% 
  filter(spoken_val==T)
```


```{r}
genre_list <- list()

as.data.frame(fromJSON(metadata_filtered[1, 'genres']))

genre_df <- data.frame()
row <- data.frame()

for (i in metadata_filtered$genres) {
  row <- fromJSON(i)
  genre_list <- c(genre_list, list(row))
  
}

dfs <- lapply(genre_list, data.frame, stringsAsFactors = FALSE)

genre_df <- rbindlist(dfs, fill = T)

# metadata_filtered <- cbind(metadata_filtered, genre_df)
```

```{r}
production_list <- list()

as.data.frame(fromJSON(metadata_filtered[1, 'production_companies']))

production_companies_df <- data.frame()
row <- data.frame()
counter <- 0

for (i in metadata_filtered$production_companies) {
  
  row <- fromJSON(i)
  production_list <- c(production_list, list(row))
  
}

dfs <- lapply(production_list, data.frame, stringsAsFactors = FALSE)

production_companies_df <- rbindlist(dfs, fill = T)
print(production_companies_df)

#metadata_filtered <- cbind(metadata_filtered, production_companies_df)
```

```{r}
production_list <- list()

as.data.frame(fromJSON(metadata_filtered[1, 'production_countries']))

production_companies_df <- data.frame()
row <- data.frame()
counter <- 0

for (i in metadata_filtered$production_countries) {
  
  row <- fromJSON(i)
  production_list <- c(production_list, list(row))
  
}

dfs <- lapply(production_list, data.frame, stringsAsFactors = FALSE)

production_countries_df <- rbindlist(dfs, fill = T)

```

```{r}
spoken_list <- list()

as.data.frame(fromJSON(metadata_filtered[1, 'spoken_languages']))

spoken_df <- data.frame()
row <- data.frame()
counter <- 0

for (i in metadata_filtered$spo) {
  
  row <- fromJSON(i)
  spoken_list <- c(spoken_list, list(row))
  
}

dfs <- lapply(spoken_list, data.frame, stringsAsFactors = FALSE)

spoken_df <- rbindlist(dfs, fill = T)

```

