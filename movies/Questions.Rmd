---
title: "Questions"
author: "Luciaaaa"
date: "03/09/2019"
output: html_document
---

```{r setup, include=FALSE}
library(pacman)
pacman::p_load(dplyr, ggplot2, tidyr, ggrepel, formattable, ggcorrplot, GGally)
knitr::opts_chunk$set(echo = TRUE)
setwd(getwd())
```


```{r}
movie_metadata <- read.csv("../data/movie_metadata.csv", sep=";")
```

```{r}
movie_metadata<- movie_metadata %>% 
  mutate(profit = gross - budget,
         return_on_investment_perc = (profit/budget)*100)
```

## Questions

Here is a list of questions we could play around with. Each title has "[ ]" on the side. If the question has been completed successfully, add an "X" inbetween the "[ ]", like "[X]". These questions have been arranged to URL links. Hopefully the source codes helps...

Also, read through ALLLLLL of the links. Let's start somewhere simple and work ourselves up. 

-----

### Link 1: https://rstudio-pubs-static.s3.amazonaws.com/384914_7bee8325659440ab9db1b3de36c37343.html

1. HeatMap [X]
> Genre VS Year that Movie is Released

```{r}
revenue_data <- movie_metadata %>%
  filter(movie_metadata$gross >= 10000000 & movie_metadata$gross >= 10000000) %>%
  mutate(ROI = (gross - budget)/budget)

dim(revenue_data)
```


```{r}
revenue_data %>%
 filter(title_year > 2013) %>%  #Filter movies released after 2000
 group_by(title_year, genres) %>%
 summarise(count = n()) %>% #Count of Movies released
 ggplot(aes(title_year, as.factor(genres)))+
 geom_tile(aes(fill=count),colour="white")+
 scale_fill_gradient(low="light blue",high = "dark blue") +
 xlab("Year of Movie release")+
 ylab("Genre of Movie Release")+
 ggtitle("Heat Map")+
  theme(axis.title.y=element_blank(),
        axis.text.y=element_blank(),
        axis.ticks.y=element_blank())
```

2. Movie Budgets [X]

```{r}
budget <- movie_metadata %>%
  select(movie_title, budget) %>%
  arrange(desc(budget)) %>%
  head(15)

x <- ggplot(budget, aes(x = reorder(movie_title, -desc(budget)), y = budget/1000000)) +
  geom_bar( stat = "identity")+ 
  theme(axis.text.x=element_text(hjust=1))+
  ggtitle("Movie Budgets")+
  xlab("")+
  ylab("Budget (in Millions)") + 
  coord_flip()

rev <- movie_metadata %>%
  select(movie_title, gross) %>%
  arrange(desc(gross)) %>%
  head(15)

y <- ggplot(rev, aes(x = (reorder(movie_title, -desc(gross))), y = gross/1000000)) +
  geom_bar( stat = "identity")+ 
  theme(axis.text.x=element_text(hjust=1))+
  ggtitle("Movie Gross")+
  xlab("")+
  ylab("Gross (in Millions)") + 
  coord_flip() 

ggarrange(x, y,
          labels = c("A", "B"),
          ncol = 1, nrow = 2)
```

3. Movie Gross [ ]
```{r}

```

4. 3D Plot [ ]
 IMDb Rating VS Budget VS Gross
```{r}
plotly::plot_ly(revenue_data, z = ~imdb_score, x = ~budget/1000000, y = ~gross/1000000, 
        color = ~(gross > budget), colors = c('#00FF00', '#FF0000'),
        size = I(3)) %>%
  add_markers() %>%
  layout(scene = list(xaxis = list(title = 'Budget(In Million Dollars'),
                      yaxis = list(title = 'Revenue(In Million Dollars'),
                      zaxis = list(title = 'IMDB Rating')),
         title = "3D Plot: IMDB Rating vs Revenue vs Budget",
         showlegend = FALSE)

```

5. Vote counts over the years [ ]

```{r}
# creating a data frame containing avg score, avg votes and avg fb likes
score_votes_likes <- movie_metadata %>% 
  group_by(genres) %>%
  summarise(count = n(),
            avg_score = round(mean(imdb_score), 1),
            avg_votes = mean(num_voted_users),
            avg_facebook_likes = mean(movie_facebook_likes),
            avg_reviews = mean(num_user_for_reviews)) %>%
  filter(count > 10)
```

IMDB rating systen started in 1990’s. Social media platforms like Facebook had started in the mid 2000’s.
```{r}
#Performing operations on Movies Vote Count over the years
 movies_vote1 <- movie_metadata %>%
  select(title_year, num_voted_users) %>%
  group_by(title_year) %>%
  summarise(count = sum(num_voted_users)) 

 ggplot(movies_vote1, aes(x = title_year, y = count/1000)) +
   geom_bar( stat = "identity") +
   geom_vline(xintercept = c(1990,2004),colour = c("orange","blue")) +
   ylab("Vote count (in thousands)") +
   xlab("Years") +
   annotate("text", label = "Facebook",x = 2003, y = 160, size = 3, colour = "blue",angle=90) + 
   annotate("text", label = "IMDB",x = 1989, y = 160, size = 3, colour = "orange",angle=90)
```

6. Popularity over the years [X]
```{r}
#Creating the required subset of data 
movies_pop <- movie_metadata %>%
 select(title_year, movie_facebook_likes) %>%
 filter(title_year > 1980) %>%
 group_by(title_year) %>%
 summarise(avg = mean(movie_facebook_likes)) 

 #generating the popularity Vs time plot
 ggplot(movies_pop, aes(x = title_year, y = avg)) +
   geom_point() +
   geom_smooth() + 
   geom_vline(xintercept = c(1990,2004),colour = c("orange","blue")) +
   ylab("Mean Popularity Score") +
   xlab("Years") +
   annotate("text", label = "Facebook",x = 2003, y = 80, size = 3, colour = "blue",angle=90)+
   annotate("text", label = "IMDB",x = 1989, y = 80, size = 3, colour = "orange",angle=90)
```

7. Distribution of Imdb Ratings
 Movie Count VS Imdb Ratings
```{r}
ggplot(movie_metadata, aes(imdb_score)) +
 geom_histogram(bins = 50) +
 geom_vline(xintercept = mean(movie_metadata$imdb_score,na.rm = TRUE),colour = "blue") +
 ylab("Movie Count") +
 xlab("IMDB Rating") +
 ggtitle("Histogram for IMDB ratings") +
  annotate("text", label = "Mean IMDB rating",x = 6.2, y = 50, size = 3, colour = "yellow",angle=90)
```

-----

### Link 2: https://rpubs.com/jasmine36/234304

1. Most Successfull Directors [ ]
> Director vs FB likes
> Director VS Gross
> Director VS Imdb
> Average Profit VS Number of Films (Points being Director)


2. Commercial Success VS Critical Acclaim [ ]
> Gross Money VS Imdb score (Profit being size of point; Point Colour being rating)
> Also available on: http://rstudio-pubs-static.s3.amazonaws.com/342210_7c8d57cfdd784cf58dc077d3eb7a2ca3.html


```{r}
movie_metadata %>%
  top_n(15, profit) %>%
  ggplot(aes(x = imdb_score, y = gross/10^6, size = profit/10^6, color = content_rating)) + 
  geom_point() + 
  geom_hline(aes(yintercept = 600)) + 
  geom_vline(aes(xintercept = 7.75)) + 
  geom_text_repel(aes(label = movie_title), size = 4) +
  xlab("Imdb score") + 
  ylab("Gross money earned in million dollars") + 
  ggtitle("Commercial success Vs Critical acclaim") +
  annotate("text", x = 8.5, y = 700, label = "High ratings \n & High gross") +
  theme(plot.title = element_text(hjust = 0.5))
```


```{r}
movie_metadata %>%
  filter(imdb_score >5 ) %>% #Filter to show the graph only for vote_average values greater than 5
 ggplot(aes(x = imdb_score, y = (gross-budget))) + #ROI == gross - budget #LUCIA PLEASE FIX:)
  geom_point(alpha = 0.5, col = "darkgreen") + 
  theme(axis.text.x=element_text(hjust=1))+
  ggtitle("ROI Vs avg_rating")+
  xlab("rating ")+
  ylab("") +
  geom_smooth()
```

Return on investment vs runtime of films:

```{r}
#Plot for ROI Vs run time
a <- ggplot(movie_metadata, aes(x = duration, y = (gross-budget))) +
  geom_point(alpha = 0.5, col = "darkgreen") + 
  ggtitle("ROI Vs Duration")+
  xlab("Duration (Minutes)")+
  ylab("") +
  geom_vline(xintercept = c(80,125),colour = c("blue","blue"))
  
#Zoomed Plot 
b <- ggplot(movie_metadata, aes(x = duration, y = (gross-budget))) +
  geom_point(alpha = 0.5, col = "darkgreen") + 
  ggtitle("Zoomed-in: 80 - 125 minutes duration")+
  xlab("Duration (Minutes)")+
  ylab("(ROI") +
  coord_cartesian(xlim = c(80, 125))

#To create two plots in the same window
ggarrange(a, b,  
          labels = c("A", "B"),
          ncol = 2, nrow = 1)
```

3. Top 20 genres with the most movies [ ]

```{r}


```

> Genre VS Freq of movies
> Look at Link 4 for more inspo (LOL) Need to choose way to graph... mmmmmm... probs line graph?

-----

### Link 3: http://rstudio-pubs-static.s3.amazonaws.com/342210_7c8d57cfdd784cf58dc077d3eb7a2ca3.html
Literally works on our data, however, this link does a lot of pre-processing that we might need to take a look at. For example, they use the first word in the genre column as the genre of the movie. 

1. Number of Movies Produced Per Year [ ]
> Count of movies VS Year

```{r}
movie_metadata %>%
  filter(title_year %in% c(2000:2016)) %>%
  arrange(desc(profit)) %>%
  top_n(15, profit) %>%
  ggplot(aes(x=budget, y=profit)) +
  geom_point() +
  geom_smooth() + 
  geom_text_repel(aes(label=movie_title)) +
  labs(x = "Budget $million", y = "Profit $million", title = "Top 10 Profitable Movies") +
  theme(plot.title = element_text(hjust = 0.5))
```

```{r}
movie_metadata %>%
  filter(budget > 100000) %>%
  mutate(profit = gross - budget,
         return_on_investment_perc = (profit/budget)*100) %>%
  arrange(desc(profit)) %>%
  top_n(15, profit) %>%
  ggplot(aes(x=budget/1000000, y = return_on_investment_perc)) + 
  geom_point(size = 2) + 
  geom_smooth(size = 1) + 
  geom_text_repel(aes(label = movie_title), size = 3) + 
  xlab("Budget $million") + 
  ylab("Percent Return on Investment") + 
  ggtitle("20 Most Profitable Movies based on its Return on Investment")
```


2. Most Successfull Directors [ ]
> Table representation of Director and their average IMDb rating

```{r}
movie_metadata %>%
  group_by(director_name) %>%
  summarise(avg_imdb = mean(imdb_score)) %>%
  arrange(desc(avg_imdb)) %>%
  top_n(20, avg_imdb) %>%
  formattable(list(avg_imdb = color_bar("orange")), align = 'l')
```



3. Relationship between number of FB likes and Imdb score [ ]
> Imdb score VS movie FB likes

```{r}
movie_metadata %>%
  plot_ly(x = ~movie_facebook_likes, y = ~imdb_score, color = ~content_rating , mode = "markers", text = ~content_rating, alpha = 0.7, type = "scatter")
```


4. Correlation Heatmap [ ]

```{r}
# number of directors
sum(uniqueN(movie_metadata$director_name))
```


```{r}
# number of actors
sum(uniqueN(movie_metadata[, c("actor_1_name", "actor_2_name", "actor_3_name")]))
```

Since all the names are so different for the whole dataset, there is no point to use names to predict score.

Same with plot keywords, they are too diverse to be used in the prediction.

And movie link is also a redundant variable.

```{r}
IMDB <- subset(movie_metadata, select = -c(director_name, actor_2_name, actor_1_name,
                                 movie_title, actor_3_name, plot_keywords, 
                                 movie_imdb_link))
```

For the purpose of data exploration, we added two variables based on existing variables: profit and return_on_investment_perc. In order to avoid multicollinearity, here we remove these two added variables.

```{r}
IMDB <- subset(IMDB, select = -c(profit, return_on_investment_perc))
```

First we plot the correlation heatmap for our data.

```{r}
ggcorr(IMDB, label = TRUE, label_round = 2, label_size = 2.8, size = 2, hjust = .85) +
  ggtitle("Correlation Heatmap") +
  theme(plot.title = element_text(hjust = 0.5))
```

Based on the heatmap, we can see some high correlations (greater than 0.7) between predictors.

According to the highest correlation value 0.95, we find actor_1_facebook_likes is highly correlated with the cast_total_facebook_likes, and both actor2 and actor3 are also somehow correlated to the total. So we want to modify them into two variables: actor_1_facebook_likes and other_actors_facebook_likes.

There are high correlations among num_voted_users, num_user_for_reviews and num_critic_for_reviews. We want to keep num_voted_users and take the ratio of num_user_for_reviews and num_critic_for_reviews.

```{r}
# add up actor 2 and 3 facebook likes into other actors facebook likes
IMDB$other_actors_facebook_likes <- IMDB$actor_2_facebook_likes + IMDB$actor_3_facebook_likes
# use the ratio of critical reviews amount to total reviews amount
IMDB$critic_review_ratio <- IMDB$num_critic_for_reviews / IMDB$num_user_for_reviews
# delete columns
IMDB <- subset(IMDB, select = -c(cast_total_facebook_likes, actor_2_facebook_likes, actor_3_facebook_likes, num_critic_for_reviews, num_user_for_reviews))
```

Now the correlation heatmap becomes like this.

```{r}
ggcorr(IMDB, label = TRUE, label_round = 2, label_size = 3, size = 2.5, hjust = .85) +
  ggtitle("Correlation Heatmap") +
  theme(plot.title = element_text(hjust = 0.5))
```

We don’t see any strong correlation (absolute value greater than 0.7) any more.


5. Full-Grown Tree [ ]
> Random Forest
> K-Nearest Neighbour




-----

#### Link 4: https://www.kaggle.com/karrrimba/understanding-movies-through-data
Literally works on our data. A lot of code to look trough. 

1. Genre wise share of movies for top 10 genres [ ]

2. Genre wise distribution of scores [ ]
> All genres with Imdb rating distribution

3. Bar chart for 10 highest rated genres [ ]
> Genres VS Average IMDB Score

4. Bar chart for 10 most voted genres [ ]
> Genres VS Average User Votes

5. Bar chart for 10 most FB liked genres [ ]
> Genres VS Average Facebook Likes

6. Distribution of budget and gross [ ]

7. Share of movies making profit or loss [ ]
> Did profitable movies recieve more appreciation by the users?

8. Line Graph for Avg Score/Avg Votes/Avg User Review by Title Year [ ]

9. Scatter plot for User Votes vs IMDB Score [ ]
> User Votes VS IMDB Score

10. Box plot for User Votes vs IMDB Score
> IMDB Score VS User Votes

_____


### Other Analysis Questions

1. Rating VS Budget [ ]

2. Rating VS Gross [ ]

3. Budget VS Gross [ ]

4. Most Successful/Unsuccessful Movies
> Based on their ratings

5. Highest Rated Actor
> Movie VS Imdb Score
> Most Popular Actor: Based on FB likes

-----


